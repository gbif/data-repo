<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="org.gbif.datarepo.persistence.mappers.DataPackageFileMapper">

  <resultMap id="DATA_PACKAGE_FILE_DATA_MAP" type="DataPackageFile" autoMapping="true">
    <result property="fileName" column="file_name"/>
    <result property="checksum" column="checksum"/>
  </resultMap>

  <select id="get" resultType="DataPackage" resultMap="DATA_PACKAGE_FILE_DATA_MAP">
    SELECT file_name, checksum
    FROM data_package_file
    WHERE data_package_doi = #{doi, jdbcType=OTHER, typeHandler=DoiTypeHandler}
    AND file_name = #{fileName,jdbcType=OTHER}
  </select>

  <select id="list" resultType="DataPackageFile" parameterType="String">
    SELECT file_name, checksum
    FROM data_package_file
    <where>
    <if test="_parameter != null" >
      data_package_doi=#{_parameter}
    </if>
    </where>
  </select>


  <insert id="create" parameterType="map" useGeneratedKeys="false">
    INSERT INTO data_package_file (data_package_doi, file_name, checksum)
    VALUES(#{doi, jdbcType=OTHER, typeHandler=DoiTypeHandler}, #{dpf.fileName, jdbcType=OTHER},
    #{dpf.checksum, jdbcType=OTHER})
  </insert>

  <update id="update" parameterType="map">
    UPDATE data_package_file SET
      file_name = #{dpf.fileName, jdbcType=OTHER},
      checksum = #{dpf.checksum, jdbcType=OTHER},
    WHERE data_package_doi = #{doi, jdbcType=OTHER, typeHandler=DoiTypeHandler}
    AND file_name = #{dpf.fileName,jdbcType=OTHER}
  </update>

  <delete id="delete" parameterType="map">
    DELETE data_package_doi data_package_file
    WHERE doi = #{doi,jdbcType=OTHER, typeHandler=DoiTypeHandler}
    AND file_name = #{fileName,jdbcType=OTHER}
  </delete>

</mapper>
